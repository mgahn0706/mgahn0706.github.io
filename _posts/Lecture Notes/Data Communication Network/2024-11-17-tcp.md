---  
tags:  
  - network  
  - transport-layer  
  - tcp  
share: "true"  
github_title: 2024-11-17-tcp  
title: 10. TCP  
date: 2024-11-17  
categories:  
  - Lecture Notes  
  - Data Communication Network  
---  
HDMIëŠ” point to point ì´ì§€ë§Œ ë°©í•´ê°€ ì—†ì–´ì„œ protocolì´ í•„ìš” ì—†ë‹¤.  
  
ë‹¤ë¥¸ ì‹ í˜¸ì— ì˜í•œ interruptê°€ ì—†ê¸° ë•Œë¬¸ì´ë‹¤.  
  
ì—¬ëŸ¬ê°œì˜ data-flowê°€ ë“¤ì–´ì˜¤ëŠ” ìƒí™©ì—ì„œëŠ”, protocolì´ í•„ìš”í•´ì§„ë‹¤.  
  
ê·¸ë ‡ë‹¤ë©´ switchë¥¼ ì–´ë–»ê²Œ ì²˜ë¦¬í•´ì•¼í• ê¹Œ?  
  
1. give a switch knowledge  
    - Good, but when the number of switches gets larger, we need to control all of them.  
    - If we create a centralized control machine, it becomes a single point of failure.  
    - This approach will be useful at an institutional level, such as with eduroam.  
2. Knowledge to end-host (with TCP protocol)  
    - If data arrival slows down, we can reduce the data rate to control flow  
    - This causes a fairness problemâ€”we need to be neither too humble nor too greedy  
    - Question: "Can it converge to the desired equilibrium?"  
  
---  
  
## TCP  
  
- point-to-point  
- reliable, in-order  
- pipelined  
- full-duplex data  
    - bi-directional (ACKì™€ dataë¥¼ ë™ì‹œì—)  
    - MSS  
- flow-controlled  
    - rhythmì„ ë§ì¶˜ë‹¤.  
    - maximum size of window!  
- connection-oriented  
  
---  
  
ì¼ë°˜ì ì¸ TCPì—ì„œ seq #ì™€ ACK #ì€ ë‹¤ìŒì„ ì˜ë¯¸í•œë‹¤.  
  
- Sequence Number: First byteì˜ number  
- ACK: í˜„ì¬ ê¸°ëŒ€í•˜ê³  ìˆëŠ” ë‹¤ìŒ byte  
  
---  
  
## Estimating RTT  
  
- We need to set the timeout value longer than RTT, but RTT varies.  
- We use SampleRTT to estimate RTT!  
  
`EstimatedRTT = (1-a)*EstimatedRTT + a*SampleRTT`  
  
- EWMA: Exponentially weighted moving average  
- Typically, a = 0.125 (to simplify calculations, using only shifting values)  
  
aê°€ ì‘ë‹¤ - ê¸°ì¡´ê±°ë¥¼ ë” ë”°ë¥´ê² ë‹¤.  
  
aê°€ í¬ë‹¤ - í˜„ì¬êº¼ë¥¼ ë” ë¯¿ê² ë‹¤.  
  
â†’ aëŠ” ì–¼ë§ˆë‚˜ íŒŒë€ìƒ‰ì„ ë”°ë¼ê°€ëŠ”ì§€, (fluctating ì •ë„)ë¥¼ ë‚˜íƒ€ë‚¸ë‹¤.  
  
---  
  
### Then, we need a timeout interval  
  
This consists of RTT plus a safety margin.  
  
For largely fluctuating RTTs, we need a larger margin.  
  
`DevRTT = (1-b)DevRTT + b*(|SampleRTT-EstimatedRTT|)`  
  
`TimeoutInterval = EstimatedRTT + 4*DevRTT`  
  
This assumes a normal distribution.  
  
Consequently, this method is applicable only to internet traffic, not for specially optimized CPUs.  
  
<aside> ğŸ“–  
  
Why we not assuming normal distribution in AI factory or specially optimized CPU? unlike Internet? â†’ in deterministic, controlled environment. The latency is not randomly distributed. We need to adapt CPU-specific model.  
  
</aside>  
  
---  
  
## Fast retransmit  
  
timeoutì€ ì‹¤ì œë¡œ ë§¤ìš° ê¸¸ë‹¤.  
  
- long delay for resending lost packet!  
  
â†’ Detect lost packet via duplicated ACKs.  
  
ë§Œì•½ 3ê°œê°€ duplicated ë˜ì—ˆë‹¤ë©´ timeoutê¹Œì§€ ê¸°ë‹¤ë¦¬ì§€ ë§ê³  ë°”ë¡œ ì „ì†¡  
  
---  
  
## TCP Congestion control  
  
ACK clocking: ACKê°€ ë„ì°©í•œ rhythmì— ë§ì¶° ë‹¤ì‹œ íŒ¨í‚·ì„ ë³´ë‚´ëŠ” ê²ƒ.  
  
â†’ ë‹¤ìŒ ì¥ì—ì„œ ë‹¤ì‹œ ì„¤ëª…  
  
---  
  
### TCP flow control  
  
â†’ Receiverì˜ bufferê°€ ë‹¤ ì°¨ì§€ ì•Šë„ë¡ senderê°€ ì¡°ì ˆí•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ê²ƒ  
  
senderê°€ ë³´ë‚´ëŠ” dataì˜ ì–‘ì€ `bottleneckì— ì˜í•œ ë°ì´í„° ìµœëŒ€ì–‘` ê³¼ `ìˆ˜ì‹ ìì˜ ëŠ¥ë ¥` ì¤‘ ë” ì‘ì€ ê°’ìœ¼ë¡œ ê²°ì •ëœë‹¤.  
  
ReceiverëŠ” ìì‹ ì˜ ìƒíƒœ(temperature, free buffer space size, movement ë“±)ì„ packetì— ë‹´ì•„ ë³´ë‚¸ë‹¤.  
  
â†’ cell towerì— ì „ë‹¬ë˜ê³ , queueëœë‹¤.  
  
---  
  
## Handshake!  
  
â†’ A 2-way handshake won't work due to:  
  
- Variable delays  
- Retransmitted messages  
- Message reordering  
- Inability to see the other side  
  
For example:  
  
(1) If we request a connection but it times out, we might request again. If the first request succeeds after resending, and we terminate the connection between the second request and server establishment, a half-open connection will occur.  
  
(2) If we resend a connection request and send (x+1) after establishment but before terminating, scenario (1) will happen. Additionally, the system might accept the (x+1) request sent before termination, causing a security problem.  
  
### 3-way handshake  
  
sender: SYN bit  
  
receiver: SYN, ACK bit  
  
sender: ACK bit â†’ connected!  
  
if ACK bit lost, this will not guarantee the connection, however this is the appropriate time with the tradeoff between connection-latency and reliable connection.  
  
---  
  
## Closing connection  
  
- close connection by setting FIN bit to 1.  
  
ë§ˆì¹˜ ì ìˆ˜ì´ë³„ì²˜ëŸ¼ í—¤ì–´ì§€ìê³  í†µë³´í•˜ë©´, ì¡°ê¸ˆ ìˆë‹¤ê°€ ê²°ê³¼ë¥¼ ì•Œë ¤ì¤€ë‹¤.  
  
ê²°ê³¼ë¥¼ ì•Œë ¤ì£¼ê³ ë„ ë¨¼ì € í—¤ì–´ì§€ìê³  í†µë³´í•œ ì‚¬ëŒì€ 2*(max segment lifetime)ë§Œí¼ ê¸°ë‹¤ë¦°ë‹¤.  
  
â†’ If last ACK lost, the receiver will not closed and keep sending FIN packet. So Initiator waits for reasonable time.